!function(t){"use strict";let e=function(o,i){let a=this;this.$element=t(o);this.options=t.extend({},e.DEFAULTS,i);this.cache=this.$element.val();this.$container=this.$element.parent();this.$thumbnail=t(".thumbnail",this.$container);this.$modal=t("<a />").attr("data-modal-target","#gui_modal").GUIModal({modalClass:"modal-dialog-centered modal-dialog-scrollable"});this.$modalContent=t('<div class="modal-body"><div class="cropper-crop-container"></div>'+"</div>"+'<div class="modal-footer d-flex justify-content-between">'+'<button type="button" class="btn btn-default btn-icon" data-bs-dismiss="modal"><i class="fa-solid fa-xmark"></i>'+this.options.strings["btnClose"]+"</button>"+'<div class="d-flex gap-3">'+'<button type="button" class="btn btn-default btn-icon" data-trigger="reset"><i class="fa-solid fa-clock-rotate-left"></i>'+this.options.strings["btnReset"]+"</button>"+'<button type="button" class="btn btn-default btn-icon" data-trigger="crop" data-loading-text="'+this.options.strings["loading"]+'"><i class="fa-solid fa-crop-simple"></i>'+this.options.strings["btnCrop"]+"</button>"+"</div>"+"</div>");if(typeof this.options.fileTypes=="object"){this.options.fileTypes=Object.values(this.options.fileTypes)}t(".control a",this.$container).on("click",(function(e){e.preventDefault();if(t(this).data("trigger")==="upload"){a.upload()}if(t(this).data("trigger")==="clear"){a.clear()}}));this.updatePreview()};e.prototype.updatePreview=function(t){t=t||this.$element.val();if(t){this.$thumbnail.removeClass("empty").css("background-image","url("+t+")")}else{this.$thumbnail.addClass("empty").css("background-image","")}};e.prototype.upload=function(){let e=this;let o=t('<input type="file" accept="'+e.options.accepts+'" />');o.on("change",(function(){if(t(this)[0].files.length){e.$thumbnail.addClass("loading");let o=t(this)[0].files[0]["type"];if(e.options.fileTypes.indexOf(o)===-1){e.$thumbnail.removeClass("loading");return}let i=e.$modalContent.clone();let a=t('<img class="gui-cropper-image" src />').attr("src",(URL||webkit).createObjectURL(t(this)[0].files[0]));a.on("load",(function(){t("#gui_modal").on("show.bs.modal.cropper",(function(){t("#gui_modal").off("show.bs.modal.cropper");t("#gui_modal .modal-dialog").addClass("loading");t("#gui_modal .modal-content").html(i);t("#gui_modal .modal-content .cropper-crop-container").append(a);gui.init("#gui_modal .modal-footer")}));t("#gui_modal").on("shown.bs.modal.cropper",(function(){t("#gui_modal").off("shown.bs.modal.cropper");let o=new Cropper(t("#gui_modal .modal-content .gui-cropper-image")[0],{viewMode:e.options.viewMode,aspectRatio:e.options.width/e.options.height,guides:false,dragMode:"move",autoCropArea:1,rotatable:false,responsive:true,restore:true,ready:function(){t(".loading",i).remove();t("#gui_modal .modal-dialog").removeClass("loading");t("#gui_modal .modal-content button[data-trigger=crop]").on("click",(function(){e.crop(o)}));t("#gui_modal .modal-content button[data-trigger=reset]").on("click",(function(){o.reset()}))}})}));t("#gui_modal").on("hidden.bs.modal.cropper",(function(){t("#gui_modal").off("hidden.bs.modal.cropper");t("#gui_modal .modal-content").html("");e.$thumbnail.removeClass("loading")}));e.$modal.data("gui.modal.initiator").show()}))}}));o.trigger("click")};e.prototype.crop=function(t){let e=this;let o=new Image;o.onload=function(){let t=document.createElement("canvas");let i=t.getContext("2d");let a=e.options.height/o.height;t.width=o.width;t.height=o.height;i.drawImage(o,0,0,t.width,t.height);if(a<1){t=gui.canvasScale(t,a)}t.toBlob((o=>{e.updatePreview((URL||webkit).createObjectURL(o));e.$element.val(t.toDataURL());e.$modal.data("gui.modal.initiator").hide()}))};t.getCroppedCanvas().toBlob((t=>{o.src=(URL||webkit).createObjectURL(t)}))};e.prototype.clear=function(){this.$element.val("");this.updatePreview()};e.DEFAULTS={height:128,width:128,viewMode:1,antialising:.8,fileTypes:["image/png","image/jpeg"],accepts:".png,.jpg,.jpeg",strings:{btnClose:"Close",btnCrop:"Crop",btnReset:"Reset",loading:"Loading..."}};t.fn.GUIControlImage=function(o){t.each(this,(function(){let i=t(this);let a=i.data("gui.image");let n=typeof o=="object"&&o;if(!a)i.data("gui.image",new e(this,n))}))}}(jQuery);