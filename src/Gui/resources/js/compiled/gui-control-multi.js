!function(t){"use strict";let e=function(i,n){let s=this;this.$element=t(i);this.options=t.extend({},e.DEFAULTS,n);this.eventNS="."+gui.getUID("multiline");t("a[data-trigger=add]",this.$element).on("click",(function(){s.add()}));this.count=t("table>tbody>tr",this.$element).length;t("table>tbody>tr",this.$element).each((function(){s.updateEvents(t(this))}));this.updateRestrictions();if(this.options.sortable){new Sortable(t("table>tbody",this.$element)[0],{handle:"a[data-trigger=move]",direction:"vertical",ghostClass:"sortable-ghost",animation:100,onChange:function(){s.bindNewLineEvent()}})}s.statusChanged();this.$element.trigger("gui.loaded")};e.prototype.updateEvents=function(e){let i=this;t("a[data-trigger=remove]",e).on("click"+this.eventNS,(function(){i.remove(t(this).parents("tr"))}))};e.prototype.bindNewLineEvent=function(){let e=this;if(this.options.newLineOnTab){t("input",this.$element).off("keydown"+this.eventNS);t("table>tbody>tr:last-child>td input",this.$element).last().on("keydown"+this.eventNS,(function(t){if(t.keyCode==9){e.add()}}))}};e.prototype.add=function(e){e=e||false;if(this.count<this.options.max||this.options.max<1||e){let e=t("table>tbody>tr:last-child",this.$element);let i=e.clone();t("input, select, textarea",i).removeClass("is-invalid").val("");t(".invalid-feedback",i).remove();i.insertAfter(e);this.updateEvents(i);this.count++;this.updateRestrictions();this.$element.trigger("gui.add",i)}};e.prototype.remove=function(t){if(this.count===1){this.add(true)}t.remove();this.count--;this.updateRestrictions();this.$element.trigger("gui.remove")};e.prototype.updateRestrictions=function(){let e=t("a[data-trigger=add]",this.$element);let i=t("a[data-trigger=move]",this.$element);if(this.options.max>0&&this.count>=this.options.max){e.addClass("disabled")}else{e.removeClass("disabled")}if(this.count===1){i.addClass("disabled")}else{i.removeClass("disabled")}this.bindNewLineEvent()};e.prototype.statusChanged=function(){if(this.$element.hasClass("readonly")){t("a",this.$element).addClass("disabled");t("input, select, textarea",this.$element).prop("readonly",true)}else{t("a",this.$element).removeClass("disabled");t("input, select, textarea",this.$element).prop("readonly",false);this.updateRestrictions()}this.bindNewLineEvent()};e.DEFAULTS={sortable:true,max:5,newLineOnTab:true};t.fn.GUIControlMulti=function(i){t.each(this,(function(){let n=t(this);let s=n.data("gui.multi");let a=typeof i=="object"&&i;if(!s)n.data("gui.multi",new e(this,a))}))}}(jQuery);